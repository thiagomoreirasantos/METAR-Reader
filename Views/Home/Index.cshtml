@model WeatherSearchModel
@{
    ViewData["Title"] = "Airport Weather";
}

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="weather-card p-4 p-md-5">
            <div class="text-center mb-4">
                <i class="bi bi-airplane weather-icon"></i>
                <h1 class="h2 mt-3">Airport Weather</h1>
                <p class="text-muted">Enter an airport code to get the current weather conditions</p>
            </div>

            <form method="post" class="mb-4">
                <div class="row g-2 justify-content-center">
                    <div class="col-md-6">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text"
                                   class="form-control"
                                   name="AirportCode"
                                   value="@Model?.AirportCode"
                                   placeholder="e.g., KJFK, KLAX, KORD"
                                   maxlength="4"
                                   style="text-transform: uppercase;">
                            <button type="submit" class="btn btn-primary px-4">
                                Get Weather
                            </button>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted">
                        Try: KJFK (New York), KLAX (Los Angeles), KORD (Chicago), KSFO (San Francisco)
                    </small>
                </div>
            </form>

            @if (Model?.Result != null)
            {
                <hr class="my-4">

                @if (!Model.Result.IsValid)
                {
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <div>@Model.Result.ErrorMessage</div>
                    </div>
                }
                else
                {
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-3">
                                <i class="bi bi-geo-alt-fill text-primary me-2 fs-4"></i>
                                <h2 class="h4 mb-0">@Model.Result.AirportCode</h2>
                                @if (Model.Result.ObservationTime.HasValue)
                                {
                                    <span class="badge bg-secondary ms-auto">
                                        Observed: @Model.Result.ObservationTime.Value.ToString("MMM dd, HH:mm") UTC
                                    </span>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Human Readable Summary -->
                    <div class="alert alert-primary mb-4">
                        <i class="bi bi-chat-quote-fill me-2"></i>
                        <strong>Summary:</strong> @Model.Result.HumanReadableSummary
                    </div>

                    <!-- Weather Details Grid -->
                    <div class="row g-3 mb-4">
                        @if (Model.Result.TemperatureCelsius.HasValue)
                        {
                            var fahrenheit = (int)Math.Round(Model.Result.TemperatureCelsius.Value * 9.0 / 5.0 + 32);
                            <div class="col-md-4">
                                <div class="card h-100 border-0 bg-light">
                                    <div class="card-body text-center">
                                        <i class="bi bi-thermometer-half text-danger fs-2"></i>
                                        <h5 class="card-title mt-2">Temperature</h5>
                                        <p class="card-text fs-4 mb-0">@fahrenheit°F</p>
                                        <small class="text-muted">(@Model.Result.TemperatureCelsius°C)</small>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.Result.WindSpeedKnots.HasValue)
                        {
                            var windMph = (int)Math.Round(Model.Result.WindSpeedKnots.Value * 1.15078);
                            <div class="col-md-4">
                                <div class="card h-100 border-0 bg-light">
                                    <div class="card-body text-center">
                                        <i class="bi bi-wind text-info fs-2"></i>
                                        <h5 class="card-title mt-2">Wind</h5>
                                        <p class="card-text fs-4 mb-0">@windMph mph</p>
                                        <small class="text-muted">
                                            @if (Model.Result.WindDirection == "VRB")
                                            {
                                                <span>Variable</span>
                                            }
                                            else
                                            {
                                                <span>From @Model.Result.WindDirection°</span>
                                            }
                                            @if (Model.Result.GustSpeedKnots.HasValue)
                                            {
                                                var gustMph = (int)Math.Round(Model.Result.GustSpeedKnots.Value * 1.15078);
                                                <span>, gusts @gustMph mph</span>
                                            }
                                        </small>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.Result.Visibility))
                        {
                            <div class="col-md-4">
                                <div class="card h-100 border-0 bg-light">
                                    <div class="card-body text-center">
                                        <i class="bi bi-eye text-success fs-2"></i>
                                        <h5 class="card-title mt-2">Visibility</h5>
                                        <p class="card-text fs-4 mb-0">@Model.Result.Visibility</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (Model.Result.CloudLayers.Any())
                    {
                        <div class="mb-4">
                            <h5><i class="bi bi-clouds me-2"></i>Cloud Layers</h5>
                            <ul class="list-group">
                                @foreach (var layer in Model.Result.CloudLayers)
                                {
                                    var coverageText = layer.Coverage switch
                                    {
                                        "SKC" => "Clear",
                                        "CLR" => "Clear",
                                        "FEW" => "Few clouds",
                                        "SCT" => "Scattered",
                                        "BKN" => "Broken",
                                        "OVC" => "Overcast",
                                        "VV" => "Vertical visibility",
                                        _ => layer.Coverage
                                    };
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        @coverageText
                                        @if (layer.AltitudeFeet > 0)
                                        {
                                            <span class="badge bg-primary rounded-pill">@layer.AltitudeFeet.ToString("N0") ft</span>
                                        }
                                    </li>
                                }
                            </ul>
                        </div>
                    }

                    @if (Model.Result.WeatherPhenomena.Any())
                    {
                        <div class="mb-4">
                            <h5><i class="bi bi-cloud-rain me-2"></i>Weather Conditions</h5>
                            <div class="d-flex flex-wrap gap-2">
                                @foreach (var weather in Model.Result.WeatherPhenomena)
                                {
                                    <span class="badge bg-info text-dark fs-6">@weather</span>
                                }
                            </div>
                        </div>
                    }

                    <!-- Raw METAR -->
                    <div class="mt-4">
                        <h5><i class="bi bi-code-slash me-2"></i>Raw METAR</h5>
                        <div class="raw-metar">
                            @Model.Result.RawMetar
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
